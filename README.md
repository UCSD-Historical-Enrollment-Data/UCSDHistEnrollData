<p align="center">
  <img src="https://github.com/ewang2002/UCSDHistEnrollData/blob/master/_misc/assets/project_banner.png?raw=true"  alt="Project Banner"/>
</p>

<p align="center">
  <a href="https://github.com/ewang2002/webweg">webweg</a> |
  <a href="https://github.com/ewang2002/webreg_scraper">webreg_scraper</a> |
  <b>UCSDHistEnrollmentData</b>
</p>

A repository containing enrollment data for the Spring 2022, Summer 2022, and Fall 2022 terms at UC San Diego.

Note that **this** repository contains the actual data collected by my [WebReg Scraper](https://github.com/ewang2002/webreg_scraper), along with some Python scripts designed to help clean and analyze the data. The library powering this scraper is [webweg](https://github.com/ewang2002/webweg). If you want to see the other components of this project, click on the corresponding links above.

## Table of Contents
- [Table of Contents](#table-of-contents)
- [Supported Terms](#supported-terms)
- [Content](#content)
  * [CSV Files](#csv-files)
    + [Types of CSV Files](#types-of-csv-files)
    + [Quality of CSV Files](#quality-of-csv-files)
  * [Scripts](#scripts)
- [Repository Structure](#repository-structure)
  * [`plotconfig.txt` Configuration File](#plotconfigtxt-configuration-file)
- [Setup](#setup)
  * [Required & Optional Software](#required---optional-software)
    + [Required](#required)
    + [Optional](#optional)
  * [Instructions](#instructions)
- [Inspiration](#inspiration)
- [Acknowledgements](#acknowledgements)
- [Using This Data](#using-this-data)
- [License](#license)

Generated by [this website](https://ecotrust-canada.github.io/markdown-toc/).

## Supported Terms
The following are terms that I've been collecting data for.

| Term | Information | Data Collected |
| ---- | ----------- | -------------- |
| SP22 | Spring 2022 Enrollment Data | CSE, COGS, MATH, ECE undergraduate courses |
| SP22D | Spring 2022 Drop Data | CSE, COGS, MATH, ECE undergraduate courses |
| S122 | Summer I 2022 Enrollment Data | CSE, COGS, MATH, ECE undergraduate courses |
| S122D | Summer I 2022 Drop Data | CSE, COGS, MATH, ECE undergraduate courses |
| S222 | Summer II 2022 Enrollment Data | CSE, COGS, MATH, ECE undergraduate courses |
| S222D | Summer II 2022 Drop Data | CSE, COGS, MATH, ECE undergraduate courses |
| S322 | Summer III 2022 Data | CSE, COGS, MATH, ECE undergraduate courses |

Starting with FA22, enrollment and drop data will be integrated into one term folder. Additionally, graduate and undergraduate courses will be separated.

| Term | Information | Data Collected |
| ---- | ----------- | -------------- |
| FA22 | Fall 2022 Enrollment & Drop Data (Undergraduate Only) | All undergraduate courses |
| FA22G | Fall 2022 Enrollment & Drop Data (Graduate Only) | CSE, COGS, MATH, ECE graduate courses |
| WI23 | Winter 2023 Enrollment & Drop Data (Undergraduate Only) | All undergraduate courses |
| WI23G | Winter 2023 Enrollment & Drop Data (Graduate Only) | CSE, COGS, MATH, ECE graduate courses |

To see the update status (how frequently I'm updating the CSV files here), check out [this](https://github.com/ewang2002/UCSDHistEnrollData/issues/1) issue.

## Content
This repository contains CSV files which contains information regarding the number of seats available at some time for certain classes. There are also some scripts designed to help clean and analyze the data. Additionally, there are pre-generated plots of each course that is being tracked.

### CSV Files
Each line in a CSV file is a **data point** that contains the date and time that the data was collected, the course (and section information), the number of students enrolled in that section, the total number of seats available, and the number of students in the waitlist.

As of mid August, I've collected approximately 70 million data points for ~2000 courses and 5 terms. Note that this is across *all* courses and *all* terms; it is **not** 70 million per course.

**Warning:** I started this project in Spring 2022 as a test run. Thus, the Spring 2022 CSV files may look different from the CSV files in the other terms. In particular, the Spring 2022 CSV files do not have the number of students enrolled in a class, only the number of seats available.

#### Types of CSV Files
There are several types of CSV files, which I'll be mentioning throughout this README. Note that a lot of this applies to all CSV files starting with `SP22D`. 

- Raw CSV Files: these are CSV files that just contain data for all courses, ordered by collection time. These CSV files are generated by my scraper. This is ideal if you want to do your own data processing, as this allows you to decide how you want to represent the data. The CSV columns are

  | Column Name | Column Purpose |
  | ----------- | -------------- |
  | `time` | The time when this data point was collected, represented as [Unix time](https://en.wikipedia.org/wiki/Unix_time). |
  | `subj_course_id` | The subject course number ID. For example, `CSE 100`. |
  | `sec_code` | The section code. For example, `A01`. |
  | `sec_id` | The section ID. For example, `085689`. |
  | `prof` | The instructor, in the form `Last; First Middle` (where `Middle` is optional) **or** `Staff`. |
  | `available` | The number of seats *available* for enrollment. This is the exact number shown on WebReg at the time. | 
  | `waitlist` | The number of students waitlisted for this section. This is the exact number shown on WebReg at the time. | 
  | `total` | The total number of seats available. This is the exact number shown on WebReg at the time. | 
  | `enrolled_ct` | The number of students enrolled in this section. This always shows the real number of students enrolled (as opposed to `available`). This is not shown on WebReg. |

  <details>
  <summary>Click here for an example.</summary>
  <br> 

  ```
  time,subj_course_id,sec_code,sec_id,prof,available,waitlist,total,enrolled_ct
  1661599357060,AAS 10,A01,085689,Butler; Elizabeth Annette,0,10,34,34
  1661599357060,AAS 10,A02,085690,Butler; Elizabeth Annette,0,10,34,34
  1661599357513,AAS 170,A00,085691,Butler; Elizabeth Annette,17,0,32,15
  1661599357966,AIP 197,001,085683,Staff,100,0,100,0
  1661599357966,AIP 197,002,085684,Rao; Ramesh R,50,0,50,0
  1661599357966,AIP 197,003,106411,Toda; Alexis Akira,9999,0,9999,0
  1661599357966,AIP 197,004,106536,Wixted; John T,9999,0,9999,0
  1661599357966,AIP 197,005,106554,Kiyonaga; Anastasia,9999,0,9999,0
  ... (omitted for brevity)
  1661599470129,CSE 100,A01,090033,Moshiri; Alexander Niema,0,8,189,189
  1661599470577,CSE 100R,A01,093837,Moshiri; Alexander Niema,155,0,350,195
  1661599471025,CSE 101,A01,090035,Saha; Barna & Jones; Miles E,0,25,395,395
  1661599471474,CSE 103,A01,090037,Freund; Yoav,0,10,75,75
  1661599471923,CSE 105,A01,090039,Micciancio; Daniele,86,0,350,264
  ... (omitted for brevity)
  1661599927010,AAS 10,A01,085689,Butler; Elizabeth Annette,0,10,34,34
  1661599927010,AAS 10,A02,085690,Butler; Elizabeth Annette,0,10,34,34
  1661599927455,AAS 170,A00,085691,Butler; Elizabeth Annette,17,0,32,15
  1661599927907,AIP 197,001,085683,Staff,100,0,100,0
  1661599927907,AIP 197,002,085684,Rao; Ramesh R,50,0,50,0
  1661599927907,AIP 197,003,106411,Toda; Alexis Akira,9999,0,9999,0
  1661599927907,AIP 197,004,106536,Wixted; John T,9999,0,9999,0
  1661599927907,AIP 197,005,106554,Kiyonaga; Anastasia,9999,0,9999,0
  ... (omitted for brevity)
  1661600039372,CSE 100,A01,090033,Moshiri; Alexander Niema,0,8,189,189
  1661600039820,CSE 100R,A01,093837,Moshiri; Alexander Niema,155,0,350,195
  1661600040268,CSE 101,A01,090035,Saha; Barna & Jones; Miles E,0,25,395,395
  1661600040713,CSE 103,A01,090037,Freund; Yoav,0,10,75,75
  1661600041163,CSE 105,A01,090039,Micciancio; Daniele,86,0,350,264
  ... (omitted for brevity, but you get the point)
  ```

  </details>

- "Cleaned" CSV Files: essentially just combining all raw CSV files (above) into one file. Depending on the term, this can be a _huge_ file! I will note that this is misleadingly named; in reality, this should be called "Merged" CSV Files.

- Class/Section CSV Files: these are the _real_ cleaned/processed CSV files. Here, each CSV file will represent a course's (or section's) enrollment data. The CSV columns are

  | Column Name | Column Purpose |
  | ----------- | -------------- |
  | `time` | The time when this data point was collected, represented as an ISO 8601 timestamp without the timezone part. The timezone part is assumed to be in the timezone of the machine that is processing this data, which is Pacific Time here. |
  | `enrolled` | The number of students enrolled in this section. This always shows the real number of students enrolled (as opposed to `available`). This is not shown on WebReg. |
  | `available` | The number of seats *available* for enrollment. This is the exact number shown on WebReg at the time. |
  | `waitlisted` | The number of students waitlisted for this section. This is the exact number shown on WebReg at the time. |
  | `total` | The total number of seats available. This is the exact number shown on WebReg at the time. |

  <details>
  <summary>Click here for an example.</summary>
  <br> 

  In a `CSE 11.csv` file, you can find the enrollment data for **all** sections of CSE 11:

  ```
  time,enrolled,available,waitlisted,total
  2022-08-27T04:24:26,264,0,453,147
  2022-08-27T04:33:55,264,0,453,147
  2022-08-27T04:43:02,265,0,452,147
  2022-08-27T04:52:07,265,0,452,147
  2022-08-27T05:01:13,266,0,451,147
  2022-08-27T05:10:20,269,0,448,147
  2022-08-27T05:19:48,270,0,447,147
  2022-08-27T05:28:56,271,0,446,147
  2022-08-27T05:38:04,271,0,446,147
  2022-08-27T05:47:11,271,0,446,147
  2022-08-27T05:56:18,272,0,444,147
  2022-08-27T06:05:25,274,0,443,147
  2022-08-27T06:14:33,274,0,444,147
  2022-08-27T06:23:39,275,0,443,147
  2022-08-27T06:32:45,275,0,444,147
  2022-08-27T06:41:53,276,0,443,147
  2022-08-27T06:51:03,278,0,441,147
  2022-08-27T07:00:10,279,0,440,147
  ... (omitted for brevity, but you get the point)
  ```

  Another example is `CSE 11_A01.csv`, which is the enrollment data for section `A01` of CSE 11:

  ```
  time,enrolled,available,waitlisted,total
  2022-08-27T04:24:26,79,0,149,49
  2022-08-27T04:33:55,79,0,149,49
  2022-08-27T04:43:02,80,0,148,49
  2022-08-27T04:52:07,80,0,148,49
  2022-08-27T05:01:13,80,0,148,49
  2022-08-27T05:10:20,82,0,146,49
  2022-08-27T05:19:48,83,0,145,49
  2022-08-27T05:28:56,83,0,145,49
  2022-08-27T05:38:04,83,0,145,49
  2022-08-27T05:47:11,83,0,145,49
  2022-08-27T05:56:18,83,0,145,49
  ... (omitted for brevity, but you get the point)
  ```
  </details>

#### Quality of CSV Files
Although I try my best to gather data as accurately as possible, there are still some flaws with the way I'm collecting the data, mainly due to the limitations I have to deal with while working with WebReg. Please keep the following in mind (_especially_ the last bullet point).

- All data in the CSV files are **not** guaranteed to be gathered consistently. For example, it might take $x$ minutes to cycle through all courses today, but $x + 2$ minutes to cycle through all courses in two weeks. This means it's possible that, for any two consecutive data points for the same course, the time that it took to collect those data points may differ. 
- It's possible that the raw CSV files may leave some sections for a course out (if it occurs, this will always occur at the end of the **raw** CSV files). For example, if a course has 20 sections, it's possible that some raw CSV files may **end** with only (for example) 15 sections from a cycle. This is a bug that I'm still trying to figure out.
- **There may be time periods where no data is available; this is usually due to an issue with WebReg and/or my login script.**

(Note: if you want to know what I mean by "raw" CSV file, click [here](https://github.com/ewang2002/UCSDHistEnrollData#repository-structure).)

### Scripts
There are a few Python scripts in this repository that the reader may find useful.

| Script | Purpose |
| ------ | ------- |
| `clean_raw_csvs.py` | A Python script that takes one term folder and combines all raw data into one file -- `enrollment.csv` -- that can then be broken up. This script is also responsible for validating that each row in the raw CSV files are valid (and removes any invalid rows). |
| `enroll_data_cleaner.py` | A Python script that takes one term folder and "cleans" the data by breaking the `enrollment.csv` file into class or section CSV files and putting those CSV files in the `overall` or `section` folders. |
| `plot.py` | A Python script that takes one term folder and, using the cleaned data in said folder, creates graphs for each CSV file in the `overall` and `section` folders. |

There are also two Rust programs designed to assist with the above scripts; they are:
- `separate_grad_courses`, which is designed to separate each raw CSV files in the `_holding` folder into two raw CSV files: one raw CSV file containing just graduate courses, and another containing just undergraduate courses.
- `combine_multiple`, which is designed to combine the *real cleaned* CSV files into one CSV file.

As you may have noticed, you're supposed to run the scripts in the order that they appear (top to bottom). For the Rust executables:
- The `separate_grad_courses` executable should be executed at the very beginning, and
- The `combine_multiple` executable should be executed after you run the first two Python scripts (`clean_raw_csvs.py` and `enroll_data_cleaner.py`) for the terms to be combined. After running this executable, just run `plot.py`.

That said, there are also several general scripts designed to streamline this process.
| Script | Purpose |
| ------ | ------- |
| `run.sh` | A Bash script that runs both `clean_raw_csvs.py` and `enroll_data_cleaner.py`. **This is no longer maintained and is now located in the `_misc/old_scripts` folder.** |
| `multplot.sh` | A Bash script that runs all three Python scripts above for each active terms. **This is no longer maintained and is now located in the `_misc/old_scripts` folder.** |
| `multplot.ps1` | A Powershell script that runs all three Python scripts above for each active terms. It also automatically pulls or clones and pushes the changes to GitHub. |

## Repository Structure
This repository is structured so that data for a term is put into its corresponding term folder. As such, all of the folders (except `_misc` and `_holding`) are term folders (e.g., `FA22G` is a term folder as it contains graduate enrollment data for the Fall 2022 quarter).

Within each term folder are the following folders and files:
| Name | Type | Purpose |
| ------ | ---- | ------- |
| `raw` | Folder | A folder that contains the raw CSV files generated by my [WebReg Scraper](https://github.com/ewang2002/webreg_scraper). By "raw," I mean CSV files that contain lots of information that either may not be needed when creating the graphs, or are in a format that makes it unsuitable for plotting (and hence needs to be converted). Essentially, all raw CSV files will contain are all course data combined into one file, ordered by the time they were collected. |
| `cleaned` | Folder |  A folder containing one CSV file that consists of all CSV files merged together from `raw`. Depending on the size of this file, it might be omitted; if it is omitted, you can recreate it by using the above scripts. |
| `overall` | Folder |  A folder containing one CSV file per *course* (e.g. CSE 8A with 2 sections would both be put in a file called `CSE 8A.csv`). |
| `section` | Folder |  A folder containing one CSV file per *section* (e.g. CSE 8A with 2 sections `A` and `B` would be put in two files called `CSE 8A_A.csv` and `CSE 8A_B.csv`). |
| `plot_overall` | Folder |  A folder containing all of the graphs, where each graph was created using the data points from the CSV files found in the `overall` folder. |
| `plot_section` | Folder |  A folder containing all of the graphs, where each graph was created using the data points from the CSV files found in the `section` folder. |
| `plotconfig.txt` | File | A configuration file that lets you configure a few things regarding how the graphs should look. To see an example configuration file, click [here](https://github.com/ewang2002/UCSDHistEnrollData/blob/master/plotconfig_example.py). |

Creation of a new term folder can be done using the `create_new_folder.py` script.

### `plotconfig.txt` Configuration File
As implied, every term folder *must have* a `plotconfig.txt` file; this gives the `plot.py` script the configuration information needed to run properly. 

In the `_misc/config_examples` directory of this project, there are two example files you can pick from.

| File | Information |
| ---- | ----------- |
| `plotconfig.txt` | The original configuration file. This is usually easier to work with, but doesn't allow for a lot of customization. |
| `plotconfig2.txt` | The second version of the configuration file. This configuration file is much longer and slightly more tedious to edit by default, but it gives you more control over how the plots should look (in particular, how the marker lines and regions look). **Note:** plotting 1st/2nd pass enrollment (`['sfsp', 'ofsp']`) is not possible with this version. |

`plot.py` supports both versions. Instructions on how you can use them can be found in the example files themselves, as comments. It is strongly recommended that you use the *second version* of the configuration file. **NOTE:** Be sure to rename the configuration file to `plotconfig.txt`.

## Setup
Below are instructions on how you can generate your own plots.

### Required & Optional Software
Make sure to get the latest versions of the required software.

#### Required
- [Python](https://www.python.org/).

#### Optional
- [git](https://git-scm.com/).

### Instructions

1. Download the contents of this repository. You can either download it directly, or use something like `git clone`.
2. For each term folder, make sure each file & folder under *Repository Structure* exists.
3. Next, in the base folder (the one containing all of the term folders and the scripts), open a terminal of your choice and run
    ```
    pip install -r requirements.txt
    ```
4. Make appropriate modifications to the Python files.
    - **Warning:** In [`plot.py`](https://github.com/ewang2002/UCSDHistEnrollData/blob/master/plot.py), you should modify the value for `PROCESS_COUNT` if you're planning on running this program on a significantly weaker system (e.g., instead of `10`, use a value like `5`). If you're running `plot.py` in an environment that doesn't support running multiple processes, you will need to make the appropriate modifications to the code.
5. Finally, run either `multplot.sh` or `multplot.ps1`.
    - If you're using Windows, you probably want to run [`multplot.ps1`](https://github.com/ewang2002/UCSDHistEnrollData/blob/master/multplot.ps1). 
    - If you're using Mac or Linux, you probably want to run [`multplot.sh`](https://github.com/ewang2002/UCSDHistEnrollData/blob/master/multplot.sh).

These instructions are not comprehensive, nor were they meant to be; thus, if you need any help, please create an issue [here](https://github.com/ewang2002/UCSDHistEnrollData/issues). 

## Inspiration
Several things inspired me to work on this project. 
- As a mathematics-computer science student, I'm given zero priority when it comes to enrolling in 90% of upper-division computer science courses. I can only enroll >3 weeks after all CSE majors have enrolled, which puts me at a significant disadvantage. Thus, I wanted to see what classes I had a *chance* at enrolling in so I can improve my four-year plan.
- UCSD's Computer Science and Engineering Department wasn't helpful in giving me information on how fast classes I wanted to take filled up (as seen in the screenshot below), so I decided to collect this information myself.
<img src="https://github.com/ewang2002/UCSDHistEnrollData/blob/master/_misc/assets/thanks_cse.png?raw=true"  alt="Thanks CSE Department for being helpful as always."/>

- I took [COGS 108: Data Science in Practice](https://github.com/COGS108) with [Professor Jason Fleischer](https://jgfleischer.com/) and learned a lot of things that I wanted to apply, so this project was a good place to start.
- And, of course, I wanted an excuse to learn the Rust programming language. 

## Acknowledgements
Big thanks to UCSD's [Data & GIS Lab](https://library.ucsd.edu/computing-and-technology/data-and-gis-lab/index.html) for providing me with remote access to their virtual computers.


## Using This Data
You're absolutely free to use this data for your own projects; perhaps, someone can make the next [Berkeleytime](https://berkeleytime.com/). Please be sure to cite this repository when using data found here.

## License
All files here are licensed under the MIT license.
